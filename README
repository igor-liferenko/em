EM is a UTF-8 capable text editor, written in CWEB.

I have taken the C source from

    http://github.com/hughbarney/zep

and converted it to CWEB, then added UTF-8
support (using wide-character API).

To build EM, install libncursesw5-dev and libtinfo-dev packages,
or build ncurses from source.

Add this `em' script to PATH:

    #!/bin/sh
    # Use as `em file line' or `em file:line' (for copy-paste from `grep -n')
    if [ $# = 0 ]; then
      tmp=`mktemp -p /tmp em-XXXXXX`
      file=$tmp ~/em/em
      echo $tmp
    else
      if [ $# = 1 ]; then
        if [ "${1#*:}" != "$1" ]; then
          export file="${1%:*}"
          export line=${1#*:}
        else
          export file="$1"
        fi
      else
        export file="$1"
        export line=$2
      fi
      if [ -e $file ]; then
        iconv -f UTF-8 -t UCS-2 $file >/dev/null 2>&1 || { echo Bad input; exit 1; }
      fi
      export abs=`realpath "$file"`
      [ "$abs" = $0 ] && { printf 'Edit ~/em/README and then do: sed -n \47\|#!/bin/sh|,$s/^    //p\47 ~/em/README >`which em`\n'; exit 1; }
      export db=/tmp/em.db
      grep -sq "^$abs lock$" $db && { echo File is already opened; exit 1; }
      eval `sed -n "s|^$abs \(.*\) |point=\1 bop=|p" $db 2>/dev/null`
      if [ "$point" ]; then
        chars=`wc -m <"$file"`
        [ $point -ge $chars ] && point=$((chars-1))
      fi
      [ "$edit" ] || sed -i "\|^$abs |d" $db 2>/dev/null
      echo $abs lock >>$db
      if [ "$edit" ]; then # don't save cursor position if called from tex/mf
        printf '\e]11;#d4e8db\a'
        env -u db ~/em/em
        printf '\e]11;white\a'
      else
        ~/em/em $point $bop
      fi
      sed -i "\|^$abs lock$|d" $db
    fi
