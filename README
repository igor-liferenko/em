EM is a UTF-8 capable text editor, written in CWEB.

I have taken the C source from

    http://github.com/hughbarney/zep

and converted it to CWEB, then added UTF-8
support (using wide-character API).

To build EM, install libncursesw5-dev and libtinfo-dev packages,
or build ncurses from source.

Add this `em' script to PATH:

    #!/bin/sh
    # Use as `em file line' or `em file:line' (for copy-paste from `grep -n')
    if [ $# = 0 ]; then
      tmp=`mktemp -p /tmp em-XXXXXX`
      file=$tmp ~/em/em
      echo $tmp
    else
      if [ $# = 1 ]; then
        if [ "${1#*:}" != "$1" ]; then
          export file="${1%:*}"
          export line=${1#*:}
        else
          export file="$1"
        fi
      else
        export file="$1"
        export line=$2
      fi
      export abs=`realpath "$file"`
      [ "$abs" = $0 ] && exec ~/em/em
      export db=/tmp/em.db
      if grep -sq "^$abs lock$" $db; then
        echo File is already opened
        exit 1
      fi
      eval `sed -n "s|^$abs \(.*\) |point=\1 bop=|p" $db 2>/dev/null`
      if [ "$point" ]; then
        chars=`wc -m <"$file"`
        [ $point -ge $chars ] && point=$((chars-1))
        sed -i "\|^$abs |d" $db
      fi
      echo $abs lock >>$db
      ~/em/em $point $bop
      sed -i "\|^$abs lock$|d" $db
    fi
