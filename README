EM is a UTF-8 capable text editor, written in CWEB.

I have taken the C source from

    http://github.com/hughbarney/zep

and converted it to CWEB, then added UTF-8
support (using wide-character API).

You will need:

  libncursesw5-dev
  libtinfo-dev

Add this `em' script to PATH:

    #!/bin/sh
    # Use as `em file line' or `em file:line' (for copy-paste from `grep -n')
    export DB=/tmp/em.db # TODO: add sudo detection and use /tmp/em-sudo.db
    if [ $# = 0 ]; then
      tmp=`mktemp -p /tmp em-XXXXXX`
      ~/em/em 0 $tmp
      [ $? = 0 ] && sed -i \$d $DB
      echo $tmp
    else
      if [ $# = 1 ]; then
        if [ "${1#*:}" != "$1" ]; then
          FILE="${1%:*}"
          LINE=${1#*:}
        else
          FILE="$1"
          LINE=0
        fi
      else
        if [ "${1#+}" != "$1" ]; then # for editor.ch in tex and mf
          FILE="$2"
          LINE=${1#+}
        else
          FILE="$1"
          LINE=$2
        fi
      fi
      REAL=`realpath $FILE`
      [ $REAL = `which em` ] && exec ~/em/em 0 $FILE
      if grep -sq "^$REAL lock$" $DB; then
        echo File is already opened
        exit 1
      fi
      echo $REAL lock >>$DB
      ABS=`realpath -s $FILE`
      ~/em/em $LINE "$FILE" `sed -i -e "\|^$ABS [0-9]\+ [0-9]\+\$|{s|$ABS ||;w /dev/stdout" -e 'd}' $DB`
      [ $? = 0 ] && sed -i "\$s|^|$ABS |" $DB
      sed -i "\|^$REAL lock$|d" $DB
    fi
